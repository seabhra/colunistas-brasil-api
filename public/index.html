<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3940256099942544" crossorigin="anonymous"></script>

<title>Agenda dos 300 - Duelo de Colunistas</title>

<style>
* { box-sizing: border-box; }

/* Corre√ß√£o do layout encolhendo: tiramos o justify-content: center do body 
   para evitar que o teclado empurre tudo para cima de forma estranha */
body {
    margin: 0;
    padding: 10px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #fdfcfd;
    color: #333;
    text-align: center;
    overflow-x: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh; /* Importante para n√£o esmagar */
}

#pageLoader {
    position: fixed; inset: 0; background: #fdfcfd; 
    z-index: 9999; display: flex; align-items: center; justify-content: center;
}

.loader-circle {
    width: 60px; height: 60px; border: 6px solid #e0e0e0;
    border-top: 6px solid #d847cf; border-radius: 50%; animation: spin 1.5s linear infinite;
}

@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

.app-container {
    width: 100%;
    max-width: 360px; 
    padding-top: 20px;
    display: flex;
    flex-direction: column;
}

.menu-caixa {
    background: rgba(27, 138, 160, 0.9);
    backdrop-filter: blur(6px);
    color: white;
    padding: 20px 15px; 
    border-radius: 20px;
    width: 100%;
    box-shadow: 0 10px 25px rgba(0,0,0,0.4);
}

.img-logo {
    display: block;
    margin: 0 auto 10px; 
    width: 140px;
    height: 140px;
    object-fit: contain;
}

.seletor-tema {
    width: 100%;
    padding: 15px;
    margin-bottom: 15px;
    border-radius: 12px;
    border: 2px solid #9d5fe9;
    font-size: 16px;
}

.btn-aurora {
    width: 100%;
    padding: 15px;
    margin: 5px 0;
    border: none;
    border-radius: 16px;
    font-weight: bold;
    cursor: pointer;
    font-size: 16px;
}

.roxo { background: #FA8072; color: #fff; } 
.rosa { background: #16efbd; color: #1a1a1a; }
.azul-info { background: #4caedf; color: white; } 
.verde { background: #74e95a; color: #1a1a1a; }
.amarelo-alerta { background: #ffc107; color: #333; animation: pulse 1.5s infinite; }

@keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.7); }
    70% { box-shadow: 0 0 0 10px rgba(255, 193, 7, 0); }
    100% { box-shadow: 0 0 0 0 rgba(255, 193, 7, 0); }
}

/* √Årea de Combate */
.cards-area {
    display: flex; 
    justify-content: space-between;
    align-items: center;
    margin: 15px 0;
    background: rgba(255,255,255,0.9);
    padding: 10px;
    border-radius: 20px;
}

.card-container { width: 45%; }

.card {
    width: 100%; 
    height: 160px; 
    background: #1a1a1a;
    border-radius: 15px; 
    border: 3px solid #fff; 
    overflow: hidden;
    position: relative;
}

.card img { width: 100%; height: 100%; object-fit: cover; }

.nome-colunista {
    background: #fff;
    font-size: 11px;
    font-weight: bold;
    padding: 5px;
    border-radius: 5px;
    margin-top: 5px;
    min-height: 40px;
}

#aiBox {
    display: none;
    background: white;
    padding: 15px;
    border-radius: 15px;
    margin-top: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    text-align: left;
}

.btn-zap-redondo { width: 40px; height: 40px; cursor: pointer; }
.btn-appinventor {
    background: #9c27b0;
    width: 40px; height: 40px;
    border-radius: 50%;
    border: none;
    color: white;
    font-size: 20px;
}
</style>
</head>

<body onload="document.getElementById('pageLoader').style.display='none';">
<div id="pageLoader"><div class="loader-circle"></div></div>

<div class="app-container">
  
  <div id="menuInicial" class="menu-caixa">
    <img src="imagens_app/logo_agenda.png" class="img-logo">
    <p>Selecione um tema:</p>
    <input list="temasColunistas" id="seletorTema" class="seletor-tema" placeholder="Escreva o tema...">
    <datalist id="temasColunistas"></datalist>
    <button onclick="iniciarDuelo()" class="btn-aurora roxo">‚öîÔ∏è Bora Pautar</button>
  </div>

  <div id="jogoArea" style="display:none; width:100%;">
    <div class="cards-area" id="containerFilosofos">
        <div class="card-container">
            <div class="card"><img id="fotoLunar" src="imagens_app/colunista1.png"></div>
            <div id="nomeLunar" class="nome-colunista">...</div>
        </div>
        <img src="imagens_app/versusX.png" style="width:30px;">
        <div class="card-container">
            <div class="card"><img id="fotoSolar" src="imagens_app/colunista2.png"></div>
            <div id="nomeSolar" class="nome-colunista">...</div>
        </div>
    </div>

    <div id="areaBotaoAcao">
        <button id="btnSorteio" class="btn-aurora rosa" onclick="sortear()">üÉè Jogar Agenda Setting</button>
    </div>

    <div id="status" style="font-size:12px; margin: 10px 0; color: #666;">Aguardando duelo...</div>

    <div id="aiBox">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h3 style="margin:0; font-size:16px;">Resultado</h3>
            <div style="display: flex; gap: 10px;">
                <img src="imagens_app/zap.png" class="btn-zap-redondo" onclick="shareOnWhatsApp()">
                <button id="btnAudioControle" class="btn-appinventor" onclick="toggleMusica()">üîä</button>
            </div>
        </div>
        <div id="conteudoIA" style="margin-top:10px; font-size: 14px; color:#444;"></div>
    </div>
  </div>
</div>

<script>
const shuffleAudio = new Audio('audio_app/slots_machine.mp3');
const memoriesAudio = new Audio('audio_app/darren_curtis.mp3');
memoriesAudio.loop = true;

let listaTodosColunistas = [];

// Carregar Dados
fetch("https://raw.githubusercontent.com/seabhra/colunistas-brasil-api/refs/heads/main/public/temas_colunitas.json")
.then(res => res.json()).then(data => {
    const list = document.getElementById("temasColunistas");
    (data.temas || data).forEach(t => {
        let opt = document.createElement("option"); opt.value = t; list.appendChild(opt);
    });
});

async function carregarColunistas() {
    try {
        const res = await fetch('colunistas-brasil.json');
        const d = await res.json();
        listaTodosColunistas = d.colunistas || [];
    } catch(e) { console.error("Erro JSON", e); }
}
carregarColunistas();

function iniciarDuelo() {
    if(!document.getElementById('seletorTema').value) return alert("Escolha um tema");
    document.getElementById('menuInicial').style.display = 'none';
    document.getElementById('jogoArea').style.display = 'block';
}

function sortear() {
    memoriesAudio.pause();
    memoriesAudio.currentTime = 0;
    shuffleAudio.play().catch(() => {});

    document.getElementById('areaBotaoAcao').innerHTML = `<button class="btn-aurora azul-info">Sorteando...</button>`;
    
    let ciclos = 0;
    const intervalo = setInterval(() => {
        let c1 = listaTodosColunistas[Math.floor(Math.random()*listaTodosColunistas.length)];
        let c2 = listaTodosColunistas[Math.floor(Math.random()*listaTodosColunistas.length)];
        
        document.getElementById('nomeLunar').innerText = c1.codinome;
        document.getElementById('nomeSolar').innerText = c2.codinome;
        document.getElementById('fotoLunar').src = c1.imagem;
        document.getElementById('fotoSolar').src = c2.imagem;

        if(ciclos++ > 30) {
            clearInterval(intervalo);
            document.getElementById('areaBotaoAcao').innerHTML = `<button class="btn-aurora amarelo-alerta">Analisando...</button>`;
            gerarConfrontoIA(c1, c2);
        }
    }, 100);
}

async function gerarConfrontoIA(c1, c2) {
    const tema = document.getElementById('seletorTema').value;
    try {
        const res = await fetch('/api/chat', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                messages: [{role: 'user', content: `Duelo curto entre ${c1.codinome} e ${c2.codinome} sobre ${tema}`}],
                model: 'llama-3.3-70b-versatile'
            })
        });
        const data = await res.json();
        const texto = data.choices[0].message.content;

        document.getElementById('conteudoIA').innerHTML = texto.replace(/\n/g, '<br>');
        document.getElementById('aiBox').style.display = 'block';
        document.getElementById('areaBotaoAcao').innerHTML = `<button onclick="location.reload()" class="btn-aurora verde">Novo Duelo</button>`;
        
        // Tentar tocar o √°udio - No App Inventor precisa de um "empurr√£o"
        memoriesAudio.play().then(() => {
            document.getElementById('btnAudioControle').innerText = "üîä";
        }).catch(e => {
            document.getElementById('btnAudioControle').innerText = "üîá";
        });

    } catch(e) { 
        document.getElementById('status').innerText = "Erro na IA"; 
    }
}

function toggleMusica() {
    const btn = document.getElementById('btnAudioControle');
    if(memoriesAudio.paused) {
        memoriesAudio.play();
        btn.innerText = "üîä";
    } else {
        memoriesAudio.pause();
        btn.innerText = "üîá";
    }
}

function shareOnWhatsApp() {
    const texto = document.getElementById('conteudoIA').innerText;
    const msg = `Agenda dos 300: ${texto}`;
    if(window.AppInventor) {
        window.AppInventor.setWebViewString(msg);
    } else {
        window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(msg)}`);
    }
}
</script>
</body>
</html>
