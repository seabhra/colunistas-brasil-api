<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Google AdSense -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3940256099942544"
crossorigin="anonymous"></script>

<!-- Favicon -->
<link rel="icon" href="./favicon.ico" type="image/x-icon">

<!-- √çcones PWA -->
<link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192.png">

<!-- Manifest json -->
<link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="#6b46c1">
<title>Agenda dos 300 - Duelo de Colunistas</title>

<style>
* { box-sizing: border-box; }

body {
margin: 0;
padding: 10px;
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
background: #fdfcfd;
color: white;
text-align: center;
overflow-x: hidden;
display: flex;
justify-content: center; 
align-items: center; 
min-height: 100vh;
}

#pageLoader {
position: fixed; inset: 0; background: #fdfcfd; 
z-index: 9999; display: flex; align-items: center; justify-content: center;
}

.loader-circle {
width: 60px; height: 60px; border: 6px solid #e0e0e0;
border-top: 6px solid #d847cf; border-radius: 50%; animation: spin 1.5s linear infinite;
}

@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

.app-container {
width: 100%;
max-width: 360px; 
display: flex;
flex-direction: column;
align-items: center;
}

/* Layout agrupado */
.menu-caixa {
background: rgba(27, 138, 160, 0.9);
backdrop-filter: blur(6px);
color: #333;
padding: 15px 10; 
border-radius: 20px;
width: 100%;
box-shadow: 0 10px 25px rgba(0,0,0,0.4);
}

#erroTema {
color: #ffeb3b; 
font-size: 12px;
font-weight: bold;
display: none;
margin-bottom: 10px;
}

.img-logo {
display: block;
margin: -10px auto 5px; 
width: 60%;
max-width: 200px;
aspect-ratio: 1 / 1;
object-fit: contain;
}

.img-versus-central {
width: 40px;
height: 40px;
align-self: center;
object-fit: contain;
margin: -10px 5px; 
}

.seletor-tema {
width: 100%; padding: 12px; margin: 8px 0; 
border-radius: 12px; border: 2px solid #9d5fe9;
background: white; font-weight: bold; color: #4a148c;
}

.btn-aurora {
    width: 100%;
    padding: 12px;
    margin: 2px 0; /* reduzido */
    border: none;
    border-radius: 16px;
    font-weight: bold;
    cursor: pointer;
    color: white;
    font-size: 16px;
    transition: transform 0.2s ease;
}

.btn-aurora:active { transform: scale(0.97); }

.roxo { background: #FA8072; color: #1a1a1a; } 
.rosa { background: #16efbd; color: #1a1a1a; }
.azul-info { background: #4caedf; cursor: default; color: white; } 
.verde { background: #74e95a; color: #1a1a1a; } 

/* Bot√£o Amarelo Alerta */
.amarelo-alerta { 
    background: #ffc107; 
    color: #333; 
    cursor: default; 
    animation: pulse 1.5s infinite;
}

@keyframes pulse {
    0% { opacity: 1; box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.7); }
    70% { opacity: 0.8; box-shadow: 0 0 0 10px rgba(255, 193, 7, 0); }
    100% { opacity: 1; box-shadow: 0 0 0 0 rgba(255, 193, 7, 0); }
}

/* Bot√£o App Inventor */
.btn-appinventor {
    background: #9c27b0;
    margin-top: 10px;
    display: inline-block;
    padding: 8px 16px;
    width: 220px;
}


    /* --- √Årea de Jogo --- */
    #jogoArea {
        display: none;
        width: 100%;
        flex-direction: column;
        align-items: center;
    }

    .cards-area {
        display: none; 
        justify-content: center; 
        align-items: center;
        gap: 10px;
        margin: 5px auto 15px; 
        padding: 10px; 
        background: rgba(255,255,255,0.6);
        border-radius: 20px; 
        width: 100%;
    }

    .card-container { 
        width: 48%; 
        display: flex; 
        flex-direction: column; 
        align-items: center;
    }

    .card {
        width: 100%; 
        height: 200px; 
        background: #1a1a1a;
        border-radius: 15px; 
        border: 3px solid #fff; 
        overflow: hidden;
        box-shadow: 0 8px 16px rgba(0,0,0,0.3); 
        position: relative;
        margin-bottom: 8px;
        transition: transform 0.3s;
    }

.card img { width: 100%; height: 100%; object-fit: cover; object-position: top; }

    .label-card {
        position: absolute; 
        top: 0; 
        width: 100%; 
        background: rgba(107, 70, 193, 0.9);
        color: #fff; 
        font-size: 11px; 
        padding: 4px 0; 
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 1px;
        text-align: center;
        z-index: 2;
        border-bottom: 1px solid rgba(255,255,255,0.3);
    }

    .nome-colunista {
        background: white;
        color: #333;
        font-size: 12px; 
        padding: 6px 2px; 
        border-radius: 8px;
        width: 100%;
        min-height: 45px; 
        display: flex; 
        flex-direction: column; 
        align-items: center; 
        justify-content: center; 
        text-align: center;
        font-weight: 700;
        line-height: 1.1;
        border: 1px solid #ddd;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .text-veiculo {
        font-size: 10px;
        color: #666;
        font-weight: 400;
        margin-top: 2px;
    }

#status {
margin: 10px auto; 
font-size: 13px;
color: #555; 
background: rgba(255,255,255,0.8);
padding: 10px;
width: 100%;
border-radius: 10px;
display: block;
text-align: center;
}

#aiBox {
display: none;
background: white;
color: #333;
padding: 15px;
border-radius: 15px;
text-align: left;
margin: 10px 0; 
width: 100%;
font-size: 14px;
line-height: 1.5;
box-shadow: 0 5px 15px rgba(0,0,0,0.2);
position: relative;
border: 1px solid #eee;
}

.btn-zap-redondo { 
position: absolute; top: -15px; right: -10px; 
width: 45px; height: 45px; 
cursor: pointer; z-index: 10; 
transition: transform 0.2s;
}
.btn-zap-redondo:hover { transform: scale(1.1); }

#ad-container {
margin-top: 20px;
min-height: 100px;
background-color: #f9f9f9;
border-radius: 8px;
padding: 5px;
border: 1px solid #ddd;
}
</style>
</head>

<body onload="document.getElementById('pageLoader').style.display='none';">
<div id="pageLoader"><div class="loader-circle"></div></div>

<div class="app-container">
  
  <!-- MENU INICIAL -->
  <div id="menuInicial" class="menu-caixa">
    <div class="banner-abertura">
        <img src="imagens_app/logo_agenda.png" class="img-logo" alt="Agenda">
    </div>
    <p style="color:#ede4e4; font-weight: bold; margin: 5px 0;">Digite ou selecione um tema:</p>
    <div id="erroTema">‚ö†Ô∏è Por favor, escolha um tema antes de iniciar!</div>
    <input list="temasColunistas" id="seletorTema" class="seletor-tema" placeholder="Escreva seu pr√≥prio tema...">
    <datalist id="temasColunistas"></datalist>
    <button onclick="iniciarDuelo()" class="btn-aurora roxo">‚öîÔ∏è Bora (re)Pautar a M√≠dia</button>
  </div>

     <!-- √ÅREA DE JOGO -->
     <div id="jogoArea">
        <div class="cards-area" id="containerFilosofos">
            <div class="card-container">
                <div class="card">
                    <div class="label-card">Colunistas</div>
                    <img id="fotoLunar" src="imagens_app/colunista1.png" alt="Colunista 1">
                </div>
                <div id="nomeLunar" class="nome-colunista">Aguardando...</div>
            </div>
  
            <img src="imagens_app/versusX.png" class="img-versus-central">
  
            <div class="card-container">
                <div class="card">
                    <div class="label-card">Colunistas</div>
                    <img id="fotoSolar" src="imagens_app/colunista2.png" alt="Colunista 2">
                </div>
                <div id="nomeSolar" class="nome-colunista">Aguardando...</div>
            </div>
        </div>

    <div id="areaBotaoAcao">
        <button id="btnSorteio" class="btn-aurora rosa" onclick="sortear()">üÉèJogar Agenda Setting Real</button>
    </div>
    <div id="status"> Est√° preparado? Nesta reda√ß√£o virtual, os 300 maiores nomes do colunismo e da opini√£o p√∫blica se enfrentam sem filtro institucional. Em total anonimato, seus avatares ‚Äî entre colunistas, influencers e ativistas ‚Äî desmontam o vi√©s passional das m√≠dias tradicionais e das redes em busca da metaverdade numa agenda setting real. Fora dos altos muros das newsroons, o texto vira arma e a raz√£o, escudo da sociedade. Escolha um tema ‚Äî mas aten√ß√£o: desse choque de narrativas sempre sobram farpas.</div>

    <!-- Bot√£o opcional para App Inventor controlar o √°udio manualmente -->
    <button id="btnAppInventor" class="btn-aurora btn-appinventor" onclick="toggleMusicAppInventor()" style="display:none;">üîä Parar M√∫sica</button>

    <div id="aiBox">
        <div id="ad-container">
            <span style="font-size:10px;color:#999;text-align:center;display:block">Publicidade</span>
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-3940256099942544"
                 data-ad-slot="6300978111"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
        </div>
    </div>

  </div>
</div> 

<script>
// ---------------- √ÅUDIO ----------------
const shuffleAudio = new Audio('audio_app/slots_machine.mp3');
shuffleAudio.preload = 'auto';

const memoriesAudio = new Audio('audio_app/darren_curtis.mp3');     
memoriesAudio.loop = true;
memoriesAudio.preload = 'auto';

memoriesAudio.volume = 0.5;
shuffleAudio.volume = 0.5;


    // ---------------- INTEGRA√á√ÉO APP INVENTOR ----------------
// Este "ouvinte" detecta quando o App Inventor altera o WebViewString
// Configure seu bloco no App Inventor: WebViewString -> "PARAR"
document.addEventListener('DOMContentLoaded', function() {
    // Verifica se o objeto AppInventor existe (rodando dentro do app)
    if (window.AppInventor) {
        window.AppInventor.setWebViewString = function(newString) {
            console.log("Recebido do App Inventor: " + newString);
            if (newString === "PARAR") {
                pararAudios();
            }
        };
    }
});

// ---------------- TEMAS ----------------

let listaTemas = [];
// Carregar temas do JSON
fetch("https://raw.githubusercontent.com/seabhra/colunistas-brasil-api/refs/heads/main/public/temas_colunitas.json")
.then(res => res.json())
.then(data => {
  const datalist = document.getElementById("temasColunistas");
  datalist.innerHTML = "";
  
  const listaTemas = Array.isArray(data) ? data : (data.temas || []);
  
  listaTemas.forEach(tema => {
      const option = document.createElement("option");
      option.value = tema;
      datalist.appendChild(option);
  });
  
  console.log(`Carregados ${listaTemas.length} temas.`);
}).catch(err => console.log("Erro ao carregar temas:", err));

// ---------------- DADOS ----------------
let listaTodosColunistas = []; 
let colunista1 = {};
let colunista2 = {};

async function carregarColunistas() {
    try {
        const resposta = await fetch('colunistas-brasil.json');
        if (!resposta.ok) throw new Error("Arquivo colunistas-brasil.json n√£o encontrado");
        const dados = await resposta.json();
        listaTodosColunistas = dados.colunistas || [];
        console.log(`Carregados ${listaTodosColunistas.length} colunistas.`);
    } catch (erro) {
        console.error("Erro ao carregar colunistas-brasil.json:", erro);
    }
}

carregarColunistas();

function iniciarDuelo() {
  const temaInput = document.getElementById('seletorTema').value;
  const erroEl = document.getElementById('erroTema');
  if (temaInput.trim() === "") {
      erroEl.style.display = 'block';
      return;
  }
  erroEl.style.display = 'none';
  
  document.getElementById('menuInicial').style.display = 'none';
  document.getElementById('jogoArea').style.display = 'flex';
  document.getElementById('containerFilosofos').style.display = 'flex';
}

function sortear() {
  if (listaTodosColunistas.length < 2) {
      alert("Lista de colunistas insuficiente para um duelo.");
      return;
  }

  // Garante que a m√∫sica de fundo est√° parada antes de come√ßar o sorteio
  memoriesAudio.pause();
  memoriesAudio.currentTime = 0;

  shuffleAudio.currentTime = 0;
  shuffleAudio.play().catch(e => console.log("Interagir primeiro"));

  document.getElementById('status').innerText = "No combate ao conluio de narrativas institucionalizadas, colunistas, influencers e ativistas mais incisivos da atualidade preparam seus argumentos. A luta √© contra a desinforma√ß√£o e o discurso raso direcionado. Na arena da imprensa sem vi√©s de censura, Agenda dos 300 analisa os dados para impedir que a paix√£o cegue a raz√£o informada."; 

  // ETAPA 1: Roleta Girando - Bot√£o AZUL
  const areaBotao = document.getElementById('areaBotaoAcao');
  areaBotao.innerHTML = `<button class="btn-aurora azul-info">Colunistas em combate...</button>`;

  // Esconde o bot√£o do App Inventor durante o sorteio
  document.getElementById('btnAppInventor').style.display = 'none';

  const aiBox = document.getElementById('aiBox');
  if(aiBox.style.display === 'block') {
      aiBox.style.display = 'none';
  }

  let temp1, temp2; 
  let ciclos = 0;
  
  const intervalo = setInterval(() => {
      let idx1 = Math.floor(Math.random() * listaTodosColunistas.length);
      let idx2 = Math.floor(Math.random() * listaTodosColunistas.length);
      
      while(idx1 === idx2) {
          idx2 = Math.floor(Math.random() * listaTodosColunistas.length);
      }

      temp1 = listaTodosColunistas[idx1]; 
      temp2 = listaTodosColunistas[idx2]; 
      
      document.getElementById('fotoLunar').src = temp1.imagem || "imagens_app/colunista1.png";
      document.getElementById('fotoSolar').src = temp2.imagem || "imagens_app/colunista2.png";
      
      const veiculo1 = temp1.Ve√≠culo ? `<span class="text-veiculo">${temp1.Ve√≠culo}</span>` : '';
      const veiculo2 = temp2.Ve√≠culo ? `<span class="text-veiculo">${temp2.Ve√≠culo}</span>` : '';

      document.getElementById('nomeLunar').innerHTML = `${temp1.codinome}${veiculo1}`;
      document.getElementById('nomeSolar').innerHTML = `${temp2.codinome}${veiculo2}`;

      if (ciclos++ > 100) {
          clearInterval(intervalo);
          shuffleAudio.pause();
          colunista1 = temp1;
          colunista2 = temp2;
          
          // ETAPA 2: Roleta Parou - Bot√£o AMARELO
          areaBotao.innerHTML = `<button class="btn-aurora amarelo-alerta">Aguarde um instante...</button>`;
          
          gerarConfrontoIA();
      }
  }, 80);
}

// ---------------- API CHAT (VERCEL) ----------------
async function gerarConfrontoIA() {
  const statusEl = document.getElementById('status');
  const tema = document.getElementById('seletorTema').value || "Atualidade";

  statusEl.innerText = `Os colunistas ${colunista1.codinome} vs ${colunista2.codinome} travam um duelo moderado por IA em nome da metaverdade sem vi√©s institucional.`;

  // --- IN√çCIO DA M√öSICA DE FUNDO ---
  // Tenta tocar a m√∫sica quando a an√°lise come√ßa
  memoriesAudio.play().catch(e => console.log("Autoplay de m√∫sica bloqueado pelo navegador at√© intera√ß√£o do usu√°rio."));

  const promptTexto = `Atue como um mediador de debate p√∫blico. Promova um duelo de ideias racional e profundo entre ${colunista1.codinome} (${colunista1.vi√©s_politico}, ve√≠culo: ${colunista1.Ve√≠culo}) e ${colunista2.codinome} (${colunista2.vi√©s_politico}, ve√≠culo: ${colunista2.Ve√≠culo}) sobre o tema: ${tema}. Empregue um tom jornal√≠stico e anal√≠tico a partir de textos publicados por cada um deles na m√≠dia, usando apenas seus codinomes, nunca nomes pr√≥prios.`;
  
  try {
      const res = await fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
              messages: [{ role: 'user', content: promptTexto }],
              model: 'llama-3.3-70b-versatile'
          })
      });

      if (!res.ok) {
          const errorText = await res.text();
          throw new Error(`Erro do servidor (${res.status}): ${errorText}`);
      }
      
      const data = await res.json();
      const respostaTexto = data.choices[0].message.content;
      const aiBox = document.getElementById('aiBox');

      const veiculo1Display = colunista1.Ve√≠culo ? ` - ${colunista1.Ve√≠culo}` : '';
      const veiculo2Display = colunista2.Ve√≠culo ? ` - ${colunista2.Ve√≠culo}` : '';

      aiBox.innerHTML = `
        <h2 class="ai-title" style="color:#4a148c; margin-top:0; font-size:18px;">
          Agenda dos 300
        </h2>
        
        <div id="conteudoIA" style="margin-bottom: 15px;">
          <h3 style="color:#4a148c; text-align:center; margin: 10px 0; font-size:16px;">
              ‚öîÔ∏è ${colunista1.codinome} (${colunista1.vi√©s_politico}${veiculo1Display}) vs ${colunista2.codinome} (${colunista2.vi√©s_politico}${veiculo2Display})
          </h3>
          <p style="font-size:12px; color:#666; text-align:center; margin-bottom:10px">
              <strong>Em pauta:</strong> ${tema}
          </p>
          <hr style="border:0; border-top:1px solid #eee;">
          <p style="font-size:14px; text-align:justify; color:#333;">${respostaTexto.replace(/\n/g, '<br>')}</p>
        </div>

        <img src="imagens_app/zap.png"
             class="btn-zap-redondo"
             onclick="shareOnWhatsApp()"
             alt="Compartilhar">

        <div id="ad-container">
          <span style="font-size:10px;color:#999;text-align:center;display:block">Publicidade</span>
          <ins class="adsbygoogle"
               style="display:block"
               data-ad-client="ca-pub-3940256099942544"
               data-ad-slot="6300978111"
               data-ad-format="auto"
               data-full-width-responsive="true"></ins>
        </div>
      `;

     aiBox.style.display = 'block';
     statusEl.innerText = "Fim de combate sob modera√ß√£o de IA.";
     statusEl.style.color = "#00cc66";
     statusEl.style.fontWeight = "bold";
     statusEl.style.fontSize = "14px"; // ajuste o valor como quiser

      try { (window.adsbygoogle = window.adsbygoogle || []).push({}); } catch (e) {}

      // Exibe o bot√£o do App Inventor para controle manual da m√∫sica
      document.getElementById('btnAppInventor').style.display = 'block';

      // Bot√£o Verde: Chama fun√ß√£o que PARA a m√∫sica e recarrega
      document.getElementById('areaBotaoAcao').innerHTML = `
        <button onclick="pararMusicaERecarregar()" class="btn-aurora verde">‚ôªÔ∏è Bora Pautar Nova Pauta</button>
      `;

  } catch (e) {
      console.error(e);
      statusEl.innerText = "Erro: " + e.message;
      statusEl.style.color = "red";
      
      // Em caso de erro, tamb√©m oferece bot√£o para parar m√∫sica e tentar de novo
      document.getElementById('areaBotaoAcao').innerHTML = `
        <button onclick="pararMusicaERecarregar()" class="btn-aurora verde">‚ôªÔ∏è Tentar Novamente</button>
      `;
  }
}

// ---------------- FUN√á√ïES DE CONTROLE DE √ÅUDIO ----------------

// Fun√ß√£o para parar a m√∫sica e recarregar (usada pelo bot√£o HTML)
function pararMusicaERecarregar() {
    memoriesAudio.pause();
    memoriesAudio.currentTime = 0;
    location.reload();
}

// Fun√ß√£o espec√≠fica para ser chamada pelo App Inventor
// Pode ser chamada via WebViewString ou pelo bot√£o na tela
function toggleMusicAppInventor() {
    if (memoriesAudio.paused) {
        memoriesAudio.play();
        document.getElementById('btnAppInventor').innerText = "üîä Pausar M√∫sica";
    } else {
        memoriesAudio.pause();
        // Opcional: resetar o tempo ou manter pausado
        document.getElementById('btnAppInventor').innerText = "üîä Retomar M√∫sica";
    }
}

// ---------------- WHATSAPP ----------------
function shareOnWhatsApp() {
  const box = document.getElementById('conteudoIA');
  if (!box) return;
  let texto = box.innerText;
  if (texto.length > 2000) texto = texto.substring(0, 2000) + "...";
  
  const title = "Agenda dos 300 - O Duelo de Colunistas";
  const WHATSAPP_FOOTER = "\n\n üì∞ Agenda dos 300\n‚ö° Powered by Geraldo A. Seabra";
      
  const message = `‚ú® ${title}\n\n${texto}${WHATSAPP_FOOTER}`;

  if (window.AppInventor) {
      window.AppInventor.setWebViewString(message);
  } else {
      window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(message)}`, '_blank');
  }
}

if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sw.js')
      .then(() => console.log('SW OK'))
      .catch(err => console.log('SW Fail', err));
  });
}
</script>
</body>
</html>








