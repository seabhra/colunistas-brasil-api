<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Google AdSense -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3940256099942544"
crossorigin="anonymous"></script>

<!-- Favicon -->
<link rel="icon" href="./favicon.ico" type="image/x-icon">

<!-- √çcones PWA -->
<link rel="apple-touch-icon" sizes="192x192" href="./public/icons/icon-192.png">

<!-- Manifest json (Comentado temporariamente para evitar erro 401 no console durante o debug, descomente quando o arquivo estiver configurado no servidor) -->
<!-- <link rel="manifest" href="./manifest.json"> -->
<meta name="theme-color" content="#6b46c1">
<title>Agenda dos 300 - Duelo de Colunistas</title>

<style>
    /* --- CSS Reset e Base --- */
    * { box-sizing: border-box; }

    body {
        margin: 0;
        padding: 10px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #fdfcfd 0%, #eef2f3 100%);
        color: #333;
        text-align: center;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    /* --- Loader --- */
    #pageLoader {
        position: fixed; inset: 0; background: #fdfcfd; 
        z-index: 9999; display: flex; align-items: center; justify-content: center;
    }

    .loader-circle {
        width: 60px; height: 60px; border: 6px solid #e0e0e0;
        border-top: 6px solid #d847cf; border-radius: 50%; animation: spin 1.5s linear infinite;
    }

    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

    /* --- Container Principal --- */
    .app-container {
        width: 100%;
        max-width: 400px; 
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    /* --- Menu Inicial --- */
    .menu-caixa {
        background: rgba(27, 138, 160, 0.95);
        backdrop-filter: blur(10px);
        color: white;
        padding: 25px 20px;
        border-radius: 20px;
        width: 100%;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        border: 1px solid rgba(255,255,255,0.2);
    }

    #erroTema {
        color: #ffeb3b; 
        font-size: 13px;
        font-weight: bold;
        display: none;
        margin-bottom: 10px;
        background: rgba(0,0,0,0.2);
        padding: 8px;
        border-radius: 8px;
    }

    .img-logo {
        display: block;
        margin: 0 auto 15px; 
        width: 70%;
        max-width: 180px;
        height: auto;
    }

    .seletor-tema {
        width: 100%; padding: 12px; margin: 10px 0;
        border-radius: 12px; border: 2px solid #9d5fe9;
        background: white; font-weight: bold; color: #4a148c;
        font-size: 16px;
        outline: none;
    }

    .btn-aurora {
        width: 100%; padding: 14px; margin: 8px 0; border: none;
        border-radius: 16px; font-weight: bold; cursor: pointer;
        color: white; font-size: 16px; transition: transform 0.2s, box-shadow 0.2s;
        box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    }

    .btn-aurora:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.3); }
    .btn-aurora:active { transform: scale(0.98); }

    .roxo { background: linear-gradient(45deg, #6b46c1, #9d5fe9); } 
    .rosa { background: linear-gradient(45deg, #16efbd, #0fb385); color: #1a1a1a; }
    .azul-info { background: linear-gradient(45deg, #4caedf, #2980b9); cursor: default; } 
    .verde { background: linear-gradient(45deg, #74e95a, #2ecc71); color: #1a1a1a; } 

    /* --- √Årea de Jogo --- */
    #jogoArea {
        display: none;
        width: 100%;
        flex-direction: column;
        align-items: center;
    }

    .cards-area {
        display: none; 
        justify-content: center; 
        align-items: center;
        gap: 10px;
        margin: 10px auto 20px; 
        padding: 15px; 
        background: rgba(255,255,255,0.6);
        border-radius: 20px; 
        width: 100%;
    }

    .card-container { 
        width: 48%; 
        display: flex; 
        flex-direction: column; 
        align-items: center;
    }

    .card {
        width: 100%; 
        height: 200px; 
        background: #1a1a1a;
        border-radius: 15px; 
        border: 3px solid #fff; 
        overflow: hidden;
        box-shadow: 0 8px 16px rgba(0,0,0,0.3); 
        position: relative;
        margin-bottom: 8px;
        transition: transform 0.3s;
    }

    .card img { 
        width: 100%; 
        height: 100%; 
        object-fit: cover; 
        object-position: top; 
        transition: opacity 0.3s;
    }

    /* R√≥tulo fixo no topo do card */
    .label-card {
        position: absolute; 
        top: 0; 
        width: 100%; 
        background: rgba(107, 70, 193, 0.9); /* Cor roxa s√≥lida */
        color: #fff; 
        font-size: 11px; 
        padding: 4px 0; 
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 1px;
        text-align: center;
        z-index: 2;
        border-bottom: 1px solid rgba(255,255,255,0.3);
    }

    /* √Årea do nome abaixo do card */
    .nome-colunista {
        background: white;
        color: #333;
        font-size: 12px; 
        padding: 6px 2px; 
        border-radius: 8px;
        width: 100%;
        min-height: 35px; 
        display: flex; 
        align-items: center; 
        justify-content: center; 
        text-align: center;
        font-weight: 700;
        line-height: 1.2;
        border: 1px solid #ddd;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .img-versus-central {
        width: 45px;
        height: 45px;
        object-fit: contain;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
    }

    #status {
        margin: 15px auto;
        font-size: 14px;
        color: #444; 
        background: white;
        padding: 12px;
        width: 100%;
        border-radius: 12px;
        display: block;
        text-align: justify;
        border-left: 5px solid #6b46c1;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        line-height: 1.5;
    }

    /* Caixa de Resultado da IA */
    #aiBox {
        display: none;
        background: white;
        color: #333;
        padding: 20px;
        border-radius: 15px;
        text-align: left;
        margin: 15px 0;
        width: 100%;
        font-size: 14px;
        line-height: 1.6;
        box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        border: 1px solid #e0e0e0;
        position: relative;
        animation: slideUp 0.5s ease-out;
    }

    @keyframes slideUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .ai-title {
        color: #6b46c1; 
        margin-top: 0; 
        font-size: 18px;
        border-bottom: 2px solid #f0f0f0;
        padding-bottom: 10px;
        margin-bottom: 15px;
    }

    .btn-zap-redondo { 
        position: absolute; top: -20px; right: -10px; 
        width: 50px; height: 50px; 
        cursor: pointer; z-index: 10; 
        transition: transform 0.2s;
        filter: drop-shadow(0 4px 6px rgba(0,0,0,0.2));
    }
    .btn-zap-redondo:hover { transform: scale(1.1) rotate(10deg); }

    #ad-container {
        margin-top: 20px;
        min-height: 100px;
        background-color: #f9f9f9;
        border-radius: 8px;
        padding: 5px;
        border: 1px solid #ddd;
    }
</style>
</head>

<body onload="document.getElementById('pageLoader').style.display='none';">
<div id="pageLoader"><div class="loader-circle"></div></div>

<div class="app-container">
  
  <!-- MENU INICIAL -->
  <div id="menuInicial" class="menu-caixa">
    <div class="banner-abertura">
        <!-- Usando uma imagem placeholder se a original n√£o carregar -->
        <img src="imagens_app/logo_agenda.png" 
             onerror="this.src='https://picsum.photos/seed/agenda/200/200'" 
             class="img-logo" alt="Agenda">
    </div>
    <p style="color:#fff; font-weight: bold; margin: 10px 0;">Digite ou selecione um tema:</p>
    <div id="erroTema">‚ö†Ô∏è Por favor, escolha um tema antes de iniciar!</div>
    <input list="temasFilosoficos" id="seletorTema" class="seletor-tema" placeholder="Escreva seu pr√≥prio tema...">
    <datalist id="temasFilosoficos"></datalist>
    <button onclick="iniciarDuelo()" class="btn-aurora roxo">‚öîÔ∏è Bora (re)Pautar a M√≠dia</button>
  </div>

  <!-- √ÅREA DE JOGO -->
  <div id="jogoArea">
    <div class="cards-area" id="containerFilosofos">
        <!-- Lado Esquerdo (Lunar) -->
        <div class="card-container">
            <div class="card">
                <!-- R√≥tulo FIXO "Colunistas" -->
                <div class="label-card">Colunistas</div>
                <img id="fotoLunar" src="" alt="Colunista 1">
            </div>
            <div id="nomeLunar" class="nome-colunista">Aguardando...</div>
        </div>

        <!-- VS Central -->
        <img src="imagens_app/versusX.png" 
             onerror="this.src='https://picsum.photos/seed/vs/50/50?blur=2'" 
             class="img-versus-central">

        <!-- Lado Direito (Solar) -->
        <div class="card-container">
            <div class="card">
                <!-- R√≥tulo FIXO "Colunistas" -->
                <div class="label-card">Colunistas</div>
                <img id="fotoSolar" src="" alt="Colunista 2">
            </div>
            <div id="nomeSolar" class="nome-colunista">Aguardando...</div>
        </div>
    </div>

    <div id="areaBotaoAcao">
        <button id="btnSorteio" class="btn-aurora rosa" onclick="sortear()">üÉè Jogar Real Agenda Setting</button>
    </div>

    <div id="status">Est√° preparado? Nesta reda√ß√£o virtual, os 300 maiores nomes do colunismo e da opini√£o p√∫blica se enfrentam sem filtro institucional. Escolha um tema e clique em jogar.</div>

    <!-- CAIXA DE RESULTADO -->
    <div id="aiBox">
        <div id="ad-container">
            <span style="font-size:10px;color:#999;text-align:center;display:block">Publicidade</span>
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-3940256099942544"
                 data-ad-slot="6300978111"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
        </div>
    </div>

  </div>
</div> 

<script>
// ---------------- √ÅUDIO ----------------
const shuffleAudio = new Audio('audio_app/slots_machine.mp3');
shuffleAudio.preload = 'auto';

const memoriesAudio = new Audio('audio_app/darren_curtis.mp3');     
memoriesAudio.loop = true;
memoriesAudio.preload = 'auto';

memoriesAudio.volume = 0.5;
shuffleAudio.volume = 0.5;

// ---------------- TEMAS ----------------
const temas = [
    "Vigil√¢ncia em massa", "Maldade humana", "Complexo industrial da censura",
    "Imprensa cooptada pelo discurso da extrema direita", "Pol√≠tica atual: n√≥s contra eles",
    "Geopol√≠tica internacional: novos cors√°rios", "Estado de exce√ß√£o permanente",
    "Democracias versus autocratas", "Militariza√ß√£o da pol√≠cia", "Criminaliza√ß√£o da pobreza",
    "Lawfare e justi√ßa seletiva", "Nacionalismo versus cosmopolitismo", "P√≥s-verdade e fake news",
    "Redes sociais: guerra de narrativas", "Cultura do cancelamento", "Algoritmos decidindo o que √© real",
    "Imprensa como ator pol√≠tico", "Censura privada das plataformas", "Liberdade de express√£o absoluta?",
    "Propaganda como entretenimento", "IA substituindo trabalho humano", "Crise clim√°tica e capitalismo verde",
    "Identitarismo versus universalismo", "√ìdio como capital pol√≠tico", "Sa√∫de mental como quest√£o pol√≠tica"
];

// Popula o datalist
const datalist = document.getElementById("temasFilosoficos");
datalist.innerHTML = "";
temas.forEach(tema => {
    const option = document.createElement("option");
    option.value = tema;
    datalist.appendChild(option);
});

// ---------------- DADOS ----------------
let listaTodosColunistas = [];
let colunista1 = {};
let colunista2 = {};

// Fun√ß√£o de fallback para imagem
function handleImageError(imgElement) {
    console.warn("Imagem n√£o encontrada, usando placeholder.", imgElement.src);
    imgElement.src = 'https://picsum.photos/seed/' + Math.random() + '/200/200';
}

async function carregarColunistas() {
    try {
        const resposta = await fetch('colunistas-brasil.json');
        if (!resposta.ok) throw new Error("Arquivo JSON n√£o encontrado (404)");
        const dados = await resposta.json();
        listaTodosColunistas = dados.colunistas || [];
        console.log(`Carregados ${listaTodosColunistas.length} colunistas.`);
    } catch (erro) {
        console.error("Erro ao carregar JSON:", erro);
        // Fallback de emerg√™ncia caso o JSON falhe, para o app n√£o travar
        listaTodosColunistas = [
            { codinome: "M√≠dia Tradicional", vi√©s_politico: "Centro", imagem: "" },
            { codinome: "Novo Ativismo", vi√©s_politico: "Esquerda", imagem: "" },
            { codinome: "Influencer", vi√©s_politico: "Liberal", imagem: "" },
            { codinome: "Jornalismo Investigativo", vi√©s_politico: "Centro-Esquerda", imagem: "" }
        ];
        alert("Erro ao carregar lista oficial. Usando lista de emerg√™ncia.");
    }
}
carregarColunistas();

function iniciarDuelo() {
  const temaInput = document.getElementById('seletorTema').value;
  const erroEl = document.getElementById('erroTema');
  if (temaInput.trim() === "") {
      erroEl.style.display = 'block';
      return;
  }
  erroEl.style.display = 'none';
  
  document.getElementById('menuInicial').style.display = 'none';
  document.getElementById('jogoArea').style.display = 'flex';
  document.getElementById('containerFilosofos').style.display = 'flex';
}

function sortear() {
  if (listaTodosColunistas.length < 2) {
      alert("Lista de colunistas insuficiente.");
      return;
  }

  // √Åudio
  memoriesAudio.pause();
  memoriesAudio.currentTime = 0;
  shuffleAudio.currentTime = 0;
  shuffleAudio.play().catch(e => console.log("Interagir primeiro"));

  document.getElementById('status').innerText = "No duelo contra narrativas institucionalizadas, os colunistas preparam seus argumentos...";
  
  const areaBotao = document.getElementById('areaBotaoAcao');
  areaBotao.innerHTML = `<button class="btn-aurora azul-info">Colunistas em combate...</button>`;

  const aiBox = document.getElementById('aiBox');
  if(aiBox.style.display === 'block') {
      aiBox.style.display = 'none';
  }

  // Cache de elementos para performance
  const fotoLunar = document.getElementById('fotoLunar');
  const fotoSolar = document.getElementById('fotoSolar');
  const nomeLunar = document.getElementById('nomeLunar');
  const nomeSolar = document.getElementById('nomeSolar');

  // Configurar onerror uma vez
  fotoLunar.onerror = function() { handleImageError(this); };
  fotoSolar.onerror = function() { handleImageError(this); };

  let ciclos = 0;
  const intervalo = setInterval(() => {
      try {
          let idx1 = Math.floor(Math.random() * listaTodosColunistas.length);
          let idx2 = Math.floor(Math.random() * listaTodosColunistas.length);
          
          while(idx1 === idx2) {
              idx2 = Math.floor(Math.random() * listaTodosColunistas.length);
          }

          const temp1 = listaTodosColunistas[idx1];
          const temp2 = listaTodosColunistas[idx2];
          
          // Atualiza Imagens
          fotoLunar.src = temp1.imagem || "imagens_app/colunista1.png";
          fotoSolar.src = temp2.imagem || "imagens_app/colunista2.png";
          
          // Atualiza Nomes (somente na div inferior)
          // Verifica√ß√£o de seguran√ßa para evitar crash (TypeError: Cannot set properties of null)
          if(nomeLunar) nomeLunar.innerText = temp1.codinome || "Desconhecido";
          if(nomeSolar) nomeSolar.innerText = temp2.codinome || "Desconhecido";

          // IMPORTANTE: N√ÉO mexemos no .label-card aqui, deixando ele fixo como "Colunistas"
          
          if (ciclos++ > 60) { // Reduzi ciclos para 60 (aprox 5 segundos) para n√£o ficar enjoativo
              clearInterval(intervalo);
              shuffleAudio.pause();
              
              colunista1 = temp1;
              colunista2 = temp2;
              
              gerarConfrontoIA();
          }
      } catch (err) {
          console.error("Erro no loop de sorteio:", err);
          clearInterval(intervalo);
      }
  }, 80);
}

// ---------------- API IA ----------------
async function gerarConfrontoIA() {
  const statusEl = document.getElementById('status');
  const tema = document.getElementById('seletorTema').value || "Atualidade";

  statusEl.innerText = `Aguarde... ${colunista1.codinome} e ${colunista2.codinome} est√£o analisando: ${tema}.`;

  try {
      // Simula√ß√£o de chamada de API para evitar erro se a rota /api/chat n√£o existir no ambiente est√°tico
      // Se voc√™ tiver o backend real, descomente o fetch abaixo e remova o setTimeout simulado.
      
      /* 
      const res = await fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
              messages: [{ role: 'user', content: `Duelo entre ${colunista1.codinome} e ${colunista2.codinome} sobre ${tema}.` }],
              model: 'llama-3.3-70b-versatile'
          })
      });
      const data = await res.json();
      const respostaTexto = data.choices[0].message.content;
      */

      // --- SIMULA√á√ÉO (SUBSTITUIR PELO C√ìDIGO ACIMA EM PRODU√á√ÉO) ---
      await new Promise(r => setTimeout(r, 2000)); // Delay artificial
      const respostaTexto = `**An√°lise de ${tema}**\n\n**${colunista1.codinome}** argumenta que a quest√£o central √© a manuten√ß√£o das estruturas de poder tradicionais, apontando riscos √† estabilidade econ√¥mica.\n\nJ√° **${colunista2.codinome}** rebate defendendo uma ruptura necess√°ria com o status quo, alegando que a justi√ßa social e a inova√ß√£o tecnol√≥gica n√£o podem esperar.\n\n*Conclus√£o da IA*: O impasse reflete a polariza√ß√£o atual da sociedade brasileira.`;
      // -----------------------------------------------------------

      const aiBox = document.getElementById('aiBox');

      aiBox.innerHTML = `
        <h2 class="ai-title">
          <img src="imagens_app/logo_agenda.png" onerror="this.style.display='none'" style="width:25px; vertical-align:middle; margin-right:8px;">
          Agenda dos 300 IA
        </h2>
        
        <div id="conteudoIA" style="margin-bottom: 15px;">
          <h3 style="color:#333; text-align:center; margin: 10px 0; font-size:16px;">
              ‚öîÔ∏è ${colunista1.codinome} vs ${colunista2.codinome}
          </h3>
          <p style="font-size:12px; color:#666; text-align:center; margin-bottom:10px">
              <strong>Pauta:</strong> ${tema}
          </p>
          <hr style="border:0; border-top:1px solid #eee;">
          <div style="font-size:14px; text-align:justify; color:#333; white-space: pre-line;">${respostaTexto}</div>
        </div>

        <img src="imagens_app/zap.png" onerror="this.src='https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg'"
             class="btn-zap-redondo"
             onclick="shareOnWhatsApp()"
             alt="Compartilhar">

        <div id="ad-container">
          <span style="font-size:10px;color:#999;text-align:center;display:block">Publicidade</span>
          <ins class="adsbygoogle"
               style="display:block"
               data-ad-client="ca-pub-3940256099942544"
               data-ad-slot="6300978111"
               data-ad-format="auto"
               data-full-width-responsive="true"></ins>
        </div>
      `;

      aiBox.style.display = 'block';
      statusEl.innerText = "Duelo finalizado com sucesso.";
      statusEl.style.color = "#00cc66";

      try {
          (window.adsbygoogle = window.adsbygoogle || []).push({});
      } catch (e) { console.error("Ad error", e); }

      document.getElementById('areaBotaoAcao').innerHTML = `
        <button onclick="location.reload()" class="btn-aurora verde">‚ôªÔ∏è Nova Pauta</button>
      `;

  } catch (e) {
      console.error(e);
      statusEl.innerText = "Erro ao gerar an√°lise: " + e.message;
      statusEl.style.color = "red";
      document.getElementById('areaBotaoAcao').innerHTML = `
          <button onclick="location.reload()" class="btn-aurora verde">‚ôªÔ∏è Tentar Novamente</button>
      `;
  }
}

// ---------------- WHATSAPP ----------------
function shareOnWhatsApp() {
  const box = document.getElementById('conteudoIA');
  if (!box) return;

  let texto = box.innerText.replace("Publicidade", "").trim(); // Remove palavra publicidade
  if (!texto) return;
  if (texto.length > 1500) texto = texto.substring(0, 1500) + "...";

  const message = `üóûÔ∏è *Agenda dos 300*\n\n${texto}\n\nüîó Jogue em: [URL do seu Site]`;

  if (window.AppInventor) {
      window.AppInventor.setWebViewString(message);
  } else {
      window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(message)}`, '_blank');
  }
}

// ---------------- SERVICE WORKER (SEGURO) ----------------
// Apenas registra se o arquivo sw.js existir, evitando erro 404 no console
if ('serviceWorker' in navigator && location.protocol === 'https:') {
  window.addEventListener('load', () => {
      // Tenta carregar o SW, mas ignora falhas silenciosamente para n√£o quebrar o app
      navigator.serviceWorker.register('/sw.js').catch(() => {
          console.log('Service Worker n√£o encontrado ou offline mode.');
      });
  });
}
</script>
</body>
</html>
